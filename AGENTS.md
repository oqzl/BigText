# エージェント向け指示
- 常に日本語で応答せよ
- Trailing Spaceは削除せよ
- ファイル末尾は1つの改行で終了せよ

## コード概要
- `index.html` はアプリ全体のレイアウトと初期テーマ設定を担い、トップバー・入力欄・キャンバス・各種ボタンを提供する。テーマ切り替えボタンはスクリプト読み込み前に `data-theme` を適用する即時関数を含む。
- `assets/style.css` はダーク/ライト両テーマのカラーパレットを CSS カスタムプロパティで定義し、レスポンシブなトップバー、キャンバス領域、アクションボタン、モバイル時の安全領域調整など UI 全体のスタイルを制御する。
- `assets/script.js` は DOM 参照を初期化し、テーマ保持、キャンバス描画、行高計算、PNG 保存、Web Speech API 読み上げ、モード切替（編集/閲覧）、Visual Viewport を利用したモバイルキーボード対策、自己テスト、Service Worker 登録までを包含する単一モジュールとして構成される。
- `manifest.json` は PWA メタデータ（名前・説明・アイコン・テーマカラー等）を定義する。
- `sw.js` は静的リソースを事前キャッシュし、古いキャッシュを破棄する Service Worker の実装で、ネットワークフォールバックを持つ。
- `assets/` 直下の `icon.svg` や `generate-icons.html` はアイコン生成の補助であり、ランタイムでは利用しない。

## JavaScript 構成メモ
- モードは `_mode` により `edit`/`view` を切り替え、閲覧モードではキャンバスに入力内容を描画し、ボタン表示を切り替える。キャンバス描画は `_computeMaxFontSize` による二分探索で最大フォントサイズを決定し、余白・行間を考慮して行ごとに描く。
- テーマはローカルストレージと `matchMedia('(prefers-color-scheme: dark)')` を併用して保持し、`--bg` などの CSS カスタムプロパティからキャンバスのグラデーションや文字色を再計算する。
- Speech Synthesis は `_refreshVoices` で優先ボイスを選択し、`_toggleSpeak` で開始/停止する。対応していないブラウザではボタンが無効化される。
- Visual Viewport API を利用してキーボード表示時の重なりを検知し、CSS 変数を介してトップバーやコントロール群の余白を調整する。
- 初期化処理 `_init()` は DOMContentLoaded 時に DOM を準備し、イベント登録、セルフテスト実行、Service Worker 登録、各種リスナー設定を行う。
